# Ubuntu 20.04 test environment for Bielik CLI (more stable package repos)
FROM ubuntu:20.04

# Prevent interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Fix package repositories and install system dependencies
RUN sed -i 's/archive.ubuntu.com/old-releases.ubuntu.com/g' /etc/apt/sources.list || true && \
    sed -i 's/security.ubuntu.com/old-releases.ubuntu.com/g' /etc/apt/sources.list || true && \
    apt-get update || apt-get update --fix-missing && \
    apt-get install -y \
        python3 \
        python3-pip \
        python3-venv \
        git \
        build-essential \
        curl \
        wget \
        ca-certificates \
    || (echo "Fallback to minimal installation" && \
        apt-get install -y python3 python3-pip git curl) && \
    apt-get clean || true && \
    rm -rf /var/lib/apt/lists/* || true

# Set working directory
WORKDIR /workspace

# Copy project files
COPY . .

# Make scripts executable
RUN chmod +x install.sh run.py quick-install.sh install.py 2>/dev/null || true

# Install Bielik CLI with Context Provider Commands (skip AI models for testing)
RUN python3 install.py --skip-ai || echo "Installation completed with warnings"

# Set default command for testing
CMD ["python3", "run.py", "--info"]
